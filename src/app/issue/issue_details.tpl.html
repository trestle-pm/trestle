<div class="issue_detail"
     ng-controller="IssueCtrl as issueCtrl"
     ng-init="issueCtrl.init(issue)" >

  <div class="header">
    <li class="user-selector dropdown">
      <a class="dropdown-toggle">
        <img class="avatar"
            ng-class="{
                empty: !issueCtrl.issue.assignee
             }"
             title="Assigned to {{issueCtrl.getAssignedUserDetails(30).name}}"
             ng-src="{{issueCtrl.getAssignedUserDetails(30).avatar_url}}"/>
      </a>
      <ul class="dropdown-menu">
        <li ng-repeat="user in repoModel.assignees"
            class="assignee"
            ng-click="issueCtrl.assignUser(user)">
          <img class="avatar" ng-src="{{user.avatar_url}}?s=30"></img>
          <span class="user_login">{{user.login}}</span>
        </li>
      </ul>
    </li>

    <span class="title">
      {{issueCtrl.issue.title}}
    </span>
    <a target="_blank" ng-href="{{issueCtrl.issue.html_url}}">
      <i class="icon-share"></i>
    </a>
    <i class="icon-remove" ng-click="$close()"></i>
  </div>

  <div class="status_header">
    <div ng-if="issueCtrl.isPullRequest()"
         class="build_status"
         ng-class="issueCtrl.getBuildStatus()">
      <a href="{{issueCtrl.tr_top_build_status.target_url}}" target="_blank">
      {{issueCtrl.tr_top_build_status.description}}
      </a>
    </div>

    <div class="comment_summary">
      <div class="summary">
         {{issueCtrl.tr_comments.length}} comments
      </div>

      <div class="vote_count"
          ng-class="{
           positive: issueCtrl.issue.tr_comment_voting.total > 0,
           negative: issueCtrl.issue.tr_comment_voting.total < 0
          }">
       {{issueCtrl.issue.tr_comment_voting.total}}
     </div>
    </div>

  </div>

  <div class="details">

    <div class="milestone">
      <select ng-init="msValue=issueCtrl.issue.milestone.number"
              ng-model="msValue"
              ng-options="m.number as m.title for m in repoModel.milestones"
              ng-change="issueCtrl.assignMilestone(msValue)">
        <option value="">No Milestone</option>
      </select>
    </div>

    <div class="branch_info" ng-show="issueCtrl.isPullRequest()">
      to {{issueCtrl.issue.tr_pull_details.base.label}}
      from {{issueCtrl.issue.tr_pull_details.tr_head.label}}
    </div>
  </div>

  <div class="label_bar">
    <div class="label_block">
      <li ng-repeat="label in issueCtrl.issue.labels | nonColumnLabels"
          style="background-color: #{{label.color}}">
        {{label.name}}
      </li>
    </div>

    <button ng-if="!issueCtrl.isPullRequest()"
            class="convert_pull btn btn-primary"
            ng-click="issueCtrl.convertToPull()">
    Convert to Pull
    </button>
    <button ng-if="issueCtrl.isPullRequest()"
            class="convert_pull btn">
    View Pull
    </button>
  </div>

  <div class="scroll_area">
    <div class="description">
      {{issueCtrl.issue.body}}
    </div>

    <div class="comments">
        <div class="comment"
            ng-repeat="comment in issueCtrl.issue.tr_comments">
          <img class="commenter"
               ng-src="{{comment.user.avatar_url}}?s=30"/>
          <div class="comment_body" ng-bind-html="comment.body_html"/>
        </div>
    </div>
  </div>

</div>
